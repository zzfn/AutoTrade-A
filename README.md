# AutoTrade

åŸºäº LumiBot çš„é‡åŒ–äº¤æ˜“ç³»ç»Ÿï¼Œä½¿ç”¨æœºå™¨å­¦ä¹ é©±åŠ¨çš„ç­–ç•¥è¿›è¡Œè‡ªåŠ¨äº¤æ˜“ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **å®æ—¶äº¤æ˜“** - é€šè¿‡ Alpaca API è¿›è¡Œå®ç›˜/æ¨¡æ‹Ÿç›˜äº¤æ˜“
- ğŸ“Š **å›æµ‹ç³»ç»Ÿ** - ä½¿ç”¨å†å²æ•°æ®éªŒè¯ç­–ç•¥è¡¨ç°
- ğŸ¤– **ML ç­–ç•¥** - åŸºäº Qlib/LightGBM çš„æœºå™¨å­¦ä¹ é€‰è‚¡ç­–ç•¥
- ğŸŒ **Web ç•Œé¢** - å®æ—¶ç›‘æ§ä»ªè¡¨ç›˜å’Œæ¨¡å‹ç®¡ç†
- ğŸ”„ **æ»šåŠ¨è®­ç»ƒ** - æ”¯æŒæ¨¡å‹åœ¨çº¿æ›´æ–°
- ğŸ‡¨ğŸ‡³ **A è‚¡æ”¯æŒ** - æ”¯æŒ A è‚¡å›æµ‹å’Œä¿¡å·ç”Ÿæˆï¼ˆåŸºäº AKShareï¼‰

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# å®‰è£… Python ä¾èµ–
uv sync
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
cp .env.example .env
# ç¼–è¾‘ .env å¡«å…¥ Alpaca API å¯†é’¥
```

### 3. å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼
make dev

# æˆ–ç›´æ¥è¿è¡Œ
uv run uvicorn autotrade.web_server:app --reload
```

è®¿é—® http://localhost:8000 æŸ¥çœ‹ä»ªè¡¨ç›˜ã€‚

## Qlib ML ç­–ç•¥ä½¿ç”¨æŒ‡å—

### æ¶æ„æ¦‚è¿°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Frontend (Web UI)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Strategy    â”‚  â”‚ Model       â”‚  â”‚ Rolling Update      â”‚  â”‚
â”‚  â”‚ Config      â”‚  â”‚ Management  â”‚  â”‚ Trigger             â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TradeManager                             â”‚
â”‚                    QlibMLStrategy                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Data Adapter  â”€â”€â–º  Feature Generator  â”€â”€â–º  ML Model       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1. åˆå§‹åŒ–æ•°æ®

é¦–æ¬¡ä½¿ç”¨éœ€è¦è·å–å†å²æ•°æ®å¹¶è½¬æ¢ä¸º Qlib æ ¼å¼ï¼š

```bash
# è·å–é»˜è®¤è‚¡ç¥¨æ± çš„ 2 å¹´æ•°æ®
uv run python scripts/init_qlib_data.py

# æˆ–æŒ‡å®šè‚¡ç¥¨å’Œæ—¶é—´èŒƒå›´
uv run python scripts/init_qlib_data.py \
  --symbols SPY,AAPL,MSFT,GOOGL \
  --days 730
```

### 2. è®­ç»ƒæ¨¡å‹

```bash
# åŸºç¡€è®­ç»ƒ
uv run python scripts/train_model.py --symbols SPY,AAPL,MSFT

# ä½¿ç”¨é…ç½®æ–‡ä»¶
uv run python scripts/train_model.py --config configs/qlib_ml_config.yaml

# Walk-Forward éªŒè¯
uv run python scripts/train_model.py --symbols SPY --walk-forward

# è®­ç»ƒåè®¾ç½®ä¸ºå½“å‰æ¨¡å‹
uv run python scripts/train_model.py --symbols SPY,AAPL,MSFT --set-current
```

### 3. é€šè¿‡ Web ç•Œé¢ç®¡ç†

1. è®¿é—® http://localhost:8000/models
2. é…ç½® ML ç­–ç•¥å‚æ•°ï¼ˆTop-Kã€å†å¹³è¡¡å‘¨æœŸï¼‰
3. é€‰æ‹©è¦ä½¿ç”¨çš„æ¨¡å‹
4. ç‚¹å‡»ã€Œå¯åŠ¨ç­–ç•¥ã€å¼€å§‹äº¤æ˜“
5. å¯ä»¥ç‚¹å‡»ã€ŒRolling æ›´æ–°ã€æŒ‰é’®æ›´æ–°æ¨¡å‹

### 4. API ç«¯ç‚¹

| ç«¯ç‚¹                                | æ–¹æ³• | è¯´æ˜               |
| ----------------------------------- | ---- | ------------------ |
| `/api/strategy/config`              | GET  | è·å–å½“å‰ç­–ç•¥é…ç½®   |
| `/api/strategy/ml_config`           | POST | è®¾ç½® ML ç­–ç•¥å‚æ•°   |
| `/api/models`                       | GET  | åˆ—å‡ºæ‰€æœ‰å¯ç”¨æ¨¡å‹   |
| `/api/models/current`               | GET  | è·å–å½“å‰é€‰æ‹©çš„æ¨¡å‹ |
| `/api/models/select`                | POST | é€‰æ‹©è¦ä½¿ç”¨çš„æ¨¡å‹   |
| `/api/models/rolling_update`        | POST | å¯åŠ¨ Rolling æ›´æ–°  |
| `/api/models/rolling_update/status` | GET  | è·å–æ›´æ–°çŠ¶æ€       |

## ç­–ç•¥è¯´æ˜

### QlibMLStrategyï¼ˆML ç­–ç•¥ï¼‰

åŸºäºæœºå™¨å­¦ä¹ æ¨¡å‹é¢„æµ‹çš„ç­–ç•¥ï¼š

- ä½¿ç”¨ LightGBM é¢„æµ‹æœªæ¥æ”¶ç›Šç‡
- Top-K æ’åé€‰è‚¡ï¼ˆé€‰æ‹©é¢„æµ‹åˆ†æ•°æœ€é«˜çš„ K åªè‚¡ç¥¨ï¼‰
- å®šæœŸå†å¹³è¡¡
- æ”¯æŒå‰ç«¯é…ç½®å’Œæ¨¡å‹çƒ­åˆ‡æ¢

#### ç‰¹å¾å·¥ç¨‹

é‡‡ç”¨ç±»ä¼¼ Qlib Alpha158 çš„æŠ€æœ¯æŒ‡æ ‡å› å­ï¼š

- ä»·æ ¼å›æŠ¥ç‡ï¼ˆ1/5/10/20 å¤©ï¼‰
- ç§»åŠ¨å¹³å‡çº¿åŠæ–œç‡
- æ³¢åŠ¨ç‡ï¼ˆATRã€æ ‡å‡†å·®ï¼‰
- æˆäº¤é‡å› å­
- RSIã€MACDã€å¸ƒæ—å¸¦ç­‰æŠ€æœ¯æŒ‡æ ‡

## é¡¹ç›®ç»“æ„

```
autotrade/
â”œâ”€â”€ execution/            # äº¤æ˜“æ‰§è¡Œ
â”‚   â””â”€â”€ strategies/       # äº¤æ˜“ç­–ç•¥
â”‚       â””â”€â”€ qlib_ml_strategy.py
â”œâ”€â”€ research/             # ç ”ç©¶æ¨¡å—
â”‚   â”œâ”€â”€ data/            # æ•°æ®é€‚é…
â”‚   â”œâ”€â”€ features/        # ç‰¹å¾å·¥ç¨‹
â”‚   â””â”€â”€ models/          # æ¨¡å‹è®­ç»ƒ
â”œâ”€â”€ ui/                   # Web ç•Œé¢
â”‚   â””â”€â”€ templates/
â”œâ”€â”€ trade_manager.py      # äº¤æ˜“ç®¡ç†å™¨
â””â”€â”€ web_server.py         # Web æœåŠ¡å™¨

scripts/
â”œâ”€â”€ init_qlib_data.py     # æ•°æ®åˆå§‹åŒ–
â””â”€â”€ train_model.py        # æ¨¡å‹è®­ç»ƒ

configs/
â”œâ”€â”€ universe.yaml         # è‚¡ç¥¨æ± é…ç½®
â””â”€â”€ qlib_ml_config.yaml   # ML ç­–ç•¥é…ç½®

models/                   # è®­ç»ƒå¥½çš„æ¨¡å‹
data/qlib/               # Qlib æ ¼å¼æ•°æ®
```

## A è‚¡æ”¯æŒ

### æ•°æ®æº

A è‚¡æ•°æ®ä½¿ç”¨ [AKShare](https://akshare.akfamily.xyz/) è·å–ï¼Œå…è´¹ä¸”æ— éœ€æ³¨å†Œã€‚

### è‚¡ç¥¨ä»£ç æ ¼å¼

A è‚¡ä»£ç æ ¼å¼ä¸º `6ä½æ•°å­—.å¸‚åœºåç¼€`ï¼š

- **SZ** (æ·±åœ³): `000001.SZ`, `300750.SZ`
- **SH** (ä¸Šæµ·): `600000.SH`, `688981.SH`

### åˆå§‹åŒ– A è‚¡æ•°æ®

```bash
# ä½¿ç”¨é»˜è®¤ A è‚¡è‚¡ç¥¨æ± 
uv run python scripts/init_a_stock_data.py

# æŒ‡å®šè‚¡ç¥¨å’Œæ—¶é—´èŒƒå›´
uv run python scripts/init_a_stock_data.py \
  --symbols 000001.SZ,600000.SH \
  --start-date 2023-01-01 \
  --end-date 2024-12-31
```

### A è‚¡äº¤æ˜“è§„åˆ™

å›æµ‹ä¸­è‡ªåŠ¨åº”ç”¨ä»¥ä¸‹ A è‚¡ç‰¹æ®Šè§„åˆ™ï¼š

| è§„åˆ™         | è¯´æ˜                          |
| ------------ | ----------------------------- |
| æœ€å°äº¤æ˜“å•ä½ | 100 è‚¡ï¼ˆ1 æ‰‹ï¼‰                |
| æ¶¨è·Œåœé™åˆ¶   | ä¸»æ¿ Â±10%ï¼Œåˆ›ä¸šæ¿/ç§‘åˆ›æ¿ Â±20% |
| ST è‚¡ç¥¨è¿‡æ»¤  | è‡ªåŠ¨å‰”é™¤ ST/\*ST è‚¡ç¥¨         |
| T+1 è§„åˆ™     | é€šè¿‡æ—¥çº¿é¢‘ç‡è‡ªç„¶è§„é¿          |

### Web ç•Œé¢ä½¿ç”¨

1. è®¿é—®å›æµ‹é¡µé¢
2. ç‚¹å‡»ã€ŒğŸ‡¨ğŸ‡³ Aè‚¡ã€æŒ‰é’®åˆ‡æ¢å¸‚åœº
3. è¾“å…¥ A è‚¡ä»£ç ï¼ˆå¦‚ `000001.SZ, 600000.SH`ï¼‰
4. å¼€å§‹å›æµ‹

## å¼€å‘

```bash
# è¿è¡Œæµ‹è¯•
uv run pytest

# ä»£ç æ ¼å¼åŒ–
uv run ruff format .
uv run ruff check . --fix
```

## è®¸å¯è¯

MIT
